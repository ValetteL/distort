/*!
 ______  _____ _______ _______  _____   ______ _______
 |     \   |   |______    |    |     | |_____/    |   
 |_____/ __|__ ______|    |    |_____| |    \_    |   
                                                      
 distort 1.0.0-alpha <http://isuttell.github.io/distort/>
 Contributor(s): Isaac Suttell <isaac@isaacsuttell.com>
 Last Build: 2014-11-20
*/
!function(a,b){"use strict";"function"==typeof define&&"object"==typeof define.amd?define([],function(){return b(a)}):a.Distort=b(a)}(this,function(){"use strict";function Distort(a){a=a||{},this.width=a.width,this.height=a.height,a.$el&&a.$el instanceof window.$&&(this.width=a.$el.width(),this.height=a.$el.height()),a.offset=a.offset||{},this.updateOffset(a.offset||{}),this.topLeft={x:0,y:0},this.topRight={x:this.width,y:0},this.bottomLeft={x:0,y:this.height},this.bottomRight={x:this.width,y:this.height},this.dpr=window.devicePixelRatio||!1,this.style=this.calculate()}function a(a,b,c){return a.x*b.y+b.x*c.y+c.x*a.y-a.y*b.x-b.y*c.x-c.y*a.x}var b="matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1)";return Distort.prototype.updateOffset=function(a){return a.x=a.x||"",a.y=a.y||"",a.x=a.x.indexOf("%")>-1?-parseFloat(a.x)*this.width/100:a.x.indexOf("px")>-1?-parseFloat(a.x):this.width*-.5,a.y=a.y.indexOf("%")>-1?-parseFloat(a.y)*this.height/100:a.y.indexOf("px")>-1?-parseFloat(a.y):this.height*-.5,this.offset=a,a},Distort.prototype.isValid=!1,Distort.prototype.offset={x:0,y:0},Distort.prototype.topLeft={x:0,y:0},Distort.prototype.topRight={x:0,y:0},Distort.prototype.bottomLeft={x:0,y:0},Distort.prototype.bottomRight={x:0,y:0},Distort.prototype.calculate=function(){var a,c,d,e,f,g,h,i,j=[[0,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0]],k=[0,0,0,0,0,0,0,0],l=[],m=[this.topLeft,this.topRight,this.bottomLeft,this.bottomRight],n=[0,1,2,3,4,5,6,7];for(e=0;4>e;e++)j[e][0]=j[e+4][3]=1&e?this.width+this.offset.x:this.offset.x,j[e][1]=j[e+4][4]=e>1?this.height+this.offset.y:this.offset.y,j[e][6]=(1&e?-this.offset.x-this.width:-this.offset.x)*(m[e].x+this.offset.x),j[e][7]=(e>1?-this.offset.y-this.height:-this.offset.y)*(m[e].x+this.offset.x),j[e+4][6]=(1&e?-this.offset.x-this.width:-this.offset.x)*(m[e].y+this.offset.y),j[e+4][7]=(e>1?-this.offset.y-this.height:-this.offset.y)*(m[e].y+this.offset.y),k[e]=m[e].x+this.offset.x,k[e+4]=m[e].y+this.offset.y,j[e][2]=j[e+4][5]=1,j[e][3]=j[e][4]=j[e][5]=j[e+4][0]=j[e+4][1]=j[e+4][2]=0;for(f=0;8>f;f++){for(e=0;8>e;e++)l[e]=j[e][f];for(e=0;8>e;e++){for(d=j[e],a=f>e?e:f,c=0,g=0;a>g;g++)c+=d[g]*l[g];d[f]=l[e]-=c}for(h=f,e=f+1;8>e;e++)Math.abs(l[e])>Math.abs(l[h])&&(h=e);if(h!==f){for(g=0;8>g;g++)i=j[h][g],j[h][g]=j[f][g],j[f][g]=i;i=n[h],n[h]=n[f],n[f]=i}if(0!==j[f][f])for(e=f+1;8>e;e++)j[e][f]/=j[f][f]}for(e=0;8>e;e++)n[e]=k[n[e]];for(g=0;8>g;g++)for(e=g+1;8>e;e++)n[e]-=n[g]*j[e][g];for(g=7;g>-1;g--)for(n[g]/=j[g][g],e=0;g>e;e++)n[e]-=n[g]*j[e][g];return this.hasErrors()?(this.isValid=!1,this.style=b,this.style):(this.isValid=!0,this.style="matrix3d("+parseFloat(n[0].toFixed(9))+", ",this.style+=parseFloat(n[3].toFixed(9))+", ",this.style+="0, ",this.style+=parseFloat(n[6].toFixed(9))+", ",this.style+=parseFloat(n[1].toFixed(9))+", ",this.style+=parseFloat(n[4].toFixed(9))+", ",this.style+="0, ",this.style+=parseFloat(n[7].toFixed(9))+", ",this.style+="0, ",this.style+="0, ",this.style+="1, ",this.style+="0, ",this.style+=parseFloat(n[2].toFixed(9))+", ",this.style+=parseFloat(n[5].toFixed(9))+", 0, 1)",this.dprFix&&(this.style+=" scale("+this.dpr+", "+this.dpr+") ",this.style+="perspective(1000px) ",this.style+="translateZ("+1e3*(1-this.dpr)+"px)"),this.style)},Distort.prototype.hasDistancesError=function(){var a,b;return a=this.topLeft.x-this.topRight.x,b=this.topLeft.y-this.topRight.y,Math.sqrt(a*a+b*b)<=1?!0:(a=this.bottomLeft.x-this.bottomRight.x,b=this.bottomLeft.y-this.bottomRight.y,Math.sqrt(a*a+b*b)<=1?!0:(a=this.topLeft.x-this.bottomLeft.x,b=this.topLeft.y-this.bottomLeft.y,Math.sqrt(a*a+b*b)<=1?!0:(a=this.topRight.x-this.bottomRight.x,b=this.topRight.y-this.bottomRight.y,Math.sqrt(a*a+b*b)<=1?!0:(a=this.topLeft.x-this.bottomRight.x,b=this.topLeft.y-this.bottomRight.y,Math.sqrt(a*a+b*b)<=1?!0:(a=this.topRight.x-this.bottomLeft.x,b=this.topRight.y-this.bottomLeft.y,Math.sqrt(a*a+b*b)<=1?!0:!1)))))},Distort.prototype.hasPolygonError=function(){var b,c;return b=a(this.topLeft,this.topRight,this.bottomRight),c=a(this.bottomRight,this.bottomLeft,this.topLeft),0>=b||0>=c?!0:(b=a(this.topRight,this.bottomRight,this.bottomLeft),c=a(this.bottomLeft,this.topLeft,this.topRight),0>=b||0>=c?!0:!1)},Distort.prototype.hasErrors=function(){return this.hasDistancesError()?1:this.hasPolygonError()?2:0},Distort.prototype.update=function(){return this.calculate()},Distort.prototype.toString=Distort.prototype.update,Distort.prototype.equals=function(a){return this.toString()===a.toString()},Distort.prototype.clone=function(){var a=new Distort({width:this.width,height:this.height,$el:this.$el});for(var b in this)this.hasOwnProperty[b]&&(a[b]=this[b]);return a},Distort});