/*!
 ______  _____ _______ _______  _____   ______ _______
 |     \   |   |______    |    |     | |_____/    |   
 |_____/ __|__ ______|    |    |_____| |    \_    |   
                                                      
 distort 1.1.0-alpha <http://isuttell.github.io/distort/>
 Contributor(s): Isaac Suttell <isaac@isaacsuttell.com>
 Last Build: 2014-11-24
*/
!function(a,b){"use strict";"function"==typeof define&&"object"==typeof define.amd?define([],function(){return b(a)}):a.Distort=b(a)}(this,function(){"use strict";function a(a,b){this.x=a||0,this.y=b||0}function b(b,c,d){b=b||{},b.x=b.x?b.x.toString():"",b.y=b.y?b.y.toString():"";var e=this.parse(b.x,c),f=this.parse(b.y,d);return new a(e,f)}function Distort(c){c=c||{},this.width=c.width,this.height=c.height,c.$el&&c.$el instanceof window.$&&(this.$el=c.$el,this.width=this.$el.width(),this.height=this.$el.height()),this.offset=new b(c.offset,this.width,this.height),this.matrix=g,this.topLeft=new a(0,0),this.topRight=new a(this.width,0),this.bottomLeft=new a(0,this.height),this.bottomRight=new a(this.width,this.height),this.dpr=window.devicePixelRatio||1,this.update()}function c(a){for(var b=-1;++b<16;)a[b]=parseFloat(a[b]);return a}function d(a){var b;return b="matrix3d(",b+=a.join(", "),b+=")"}function e(a,b,c){return a.x*b.y+b.x*c.y+c.x*a.y-a.y*b.x-b.y*c.x-c.y*a.x}function f(a,b){var c=["$el","offset"];for(var d in b)a[d]=h(b[d])&&-1===c.indexOf(d)?f({},b[d]):b[d];return a}var g=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];b.prototype.parse=function(a,b){return a.indexOf("%")>-1?-parseFloat(a)*b/100:a.indexOf("px")>-1?-parseFloat(a):b*-.5},a.prototype.distanceTo=function(a){var b=this.x-a.x,c=this.y-a.y;return Math.sqrt(b*b+c*c)},Distort.prototype.calculate=function(){this.isValid=!1;var a,b,d,e,f,g,h,i,j=[[0,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,1,0,0,0,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0],[0,0,0,0,0,1,0,0]],k=[0,0,0,0,0,0,0,0],l=[],m=[this.topLeft,this.topRight,this.bottomLeft,this.bottomRight],n=[0,1,2,3,4,5,6,7];for(e=0;4>e;e++)j[e][0]=j[e+4][3]=1&e?this.width+this.offset.x:this.offset.x,j[e][1]=j[e+4][4]=e>1?this.height+this.offset.y:this.offset.y,j[e][6]=(1&e?-this.offset.x-this.width:-this.offset.x)*(m[e].x+this.offset.x),j[e][7]=(e>1?-this.offset.y-this.height:-this.offset.y)*(m[e].x+this.offset.x),j[e+4][6]=(1&e?-this.offset.x-this.width:-this.offset.x)*(m[e].y+this.offset.y),j[e+4][7]=(e>1?-this.offset.y-this.height:-this.offset.y)*(m[e].y+this.offset.y),k[e]=m[e].x+this.offset.x,k[e+4]=m[e].y+this.offset.y,j[e][2]=j[e+4][5]=1,j[e][3]=j[e][4]=j[e][5]=j[e+4][0]=j[e+4][1]=j[e+4][2]=0;for(f=0;8>f;f++){for(e=0;8>e;e++)l[e]=j[e][f];for(e=0;8>e;e++){for(d=j[e],a=f>e?e:f,b=0,g=0;a>g;g++)b+=d[g]*l[g];d[f]=l[e]-=b}for(h=f,e=f+1;8>e;e++)Math.abs(l[e])>Math.abs(l[h])&&(h=e);if(h!==f){for(g=0;8>g;g++)i=j[h][g],j[h][g]=j[f][g],j[f][g]=i;i=n[h],n[h]=n[f],n[f]=i}if(0!==j[f][f])for(e=f+1;8>e;e++)j[e][f]/=j[f][f]}for(e=0;8>e;e++)n[e]=k[n[e]];for(g=0;8>g;g++)for(e=g+1;8>e;e++)n[e]-=n[g]*j[e][g];for(g=7;g>-1;g--)for(n[g]/=j[g][g],e=0;g>e;e++)n[e]-=n[g]*j[e][g];return this.matrix[0]=n[0].toFixed(9),this.matrix[1]=n[3].toFixed(9),this.matrix[2]=0,this.matrix[3]=n[6].toFixed(9),this.matrix[4]=n[1].toFixed(9),this.matrix[5]=n[4].toFixed(9),this.matrix[6]=0,this.matrix[7]=n[7].toFixed(9),this.matrix[8]=0,this.matrix[9]=0,this.matrix[10]=1,this.matrix[11]=0,this.matrix[12]=n[2].toFixed(9),this.matrix[13]=n[5].toFixed(9),this.matrix[14]=0,this.matrix[15]=1,this.matrix=c.call(this,this.matrix),this.matrix},Distort.prototype.hasDistancesError=function(){return this.topLeft.distanceTo(this.topRight)<=1?!0:this.bottomLeft.distanceTo(this.bottomRight)<=1?!0:this.topLeft.distanceTo(this.bottomLeft)<=1?!0:this.topRight.distanceTo(this.bottomRight)<=1?!0:this.topLeft.distanceTo(this.bottomRight)<=1?!0:this.topRight.distanceTo(this.bottomLeft)<=1?!0:!1},Distort.prototype.hasPolygonError=function(){var a,b;return a=e(this.topLeft,this.topRight,this.bottomRight),b=e(this.bottomRight,this.bottomLeft,this.topLeft),0>=a||0>=b?!0:(a=e(this.topRight,this.bottomRight,this.bottomLeft),b=e(this.bottomLeft,this.topLeft,this.topRight),0>=a||0>=b?!0:!1)},Distort.prototype.hasErrors=function(){return this.hasDistancesError()?1:this.hasPolygonError()?2:0},Distort.prototype.update=function(){return this.calculate(),this.hasErrors()?(this.isValid=!1,this.style=d.call(this,g),this.style):(this.isValid=!0,this.style=d.call(this,this.matrix),this.dprFix&&(this.style+=" scale("+this.dpr+", "+this.dpr+") ",this.style+="perspective(1000px) ",this.style+="translateZ("+1e3*(1-this.dpr)+"px)"),this.style)},Distort.prototype.toString=Distort.prototype.update,Distort.prototype.equals=function(a){return this.toString()===a.toString()};var h=function(a){var b={}.toString.call(a);return"[object Object]"===b};return Distort.prototype.clone=function(){return f(new Distort({}),this)},Distort.prototype.translate=function(a,b){return this.topLeft.x+=a,this.topRight.x+=a,this.bottomLeft.x+=a,this.bottomRight.x+=a,this.topLeft.y+=b,this.topRight.y+=b,this.bottomLeft.y+=b,this.bottomRight.y+=b,this},Distort.prototype.translateX=function(a){return this.translate(a,0),this},Distort.prototype.translateY=function(a){return this.translate(0,a),this},Distort.prototype.scale=function(a){return this.translate(-this.width/2,-this.height/2),this.topLeft.x*=a,this.topRight.x*=a,this.bottomLeft.x*=a,this.bottomRight.x*=a,this.topLeft.y*=a,this.topRight.y*=a,this.bottomLeft.y*=a,this.bottomRight.y*=a,this.translate(this.width/2,this.height/2),this},Distort.prototype.forcePerspective=function(a,b){if("top"===a)this.topLeft.x-=b,this.topRight.x+=b;else if("left"===a)this.topLeft.y-=b,this.bottomLeft.y+=b;else if("bottom"===a)this.bottomLeft.x-=b,this.bottomRight.x+=b;else{if("right"!==a)throw new Error("Invalid Perspective Direction");this.topRight.y-=b,this.bottomRight.y+=b}return this},Distort});